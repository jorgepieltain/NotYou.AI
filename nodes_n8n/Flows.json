[
    {
        "active": 0,
        "connections": "{\"CARGAR EMBEDDINGS SUPABASE\":{\"main\":[[{\"node\":\"Code1\",\"type\":\"main\",\"index\":0}]]},\"Code1\":{\"main\":[[{\"node\":\"Code2\",\"type\":\"main\",\"index\":0}]]},\"Code2\":{\"main\":[[{\"node\":\"Supabase Vector Store\",\"type\":\"main\",\"index\":0}]]},\"When clicking ‘Execute workflow’\":{\"main\":[[{\"node\":\"CARGAR EMBEDDINGS SUPABASE\",\"type\":\"main\",\"index\":0}]]},\"Supabase Vector Store\":{\"main\":[[]]},\"Embeddings OpenAI\":{\"ai_embedding\":[[{\"node\":\"Supabase Vector Store\",\"type\":\"ai_embedding\",\"index\":0}]]},\"Default Data Loader\":{\"ai_document\":[[{\"node\":\"Supabase Vector Store\",\"type\":\"ai_document\",\"index\":0}]]},\"Token Splitter\":{\"ai_textSplitter\":[[{\"node\":\"Default Data Loader\",\"type\":\"ai_textSplitter\",\"index\":0}]]}}",
        "createdAt": "2025-07-02 18:13:48.468",
        "id": "Q9dcajPxU6PJMZrj",
        "isArchived": 0,
        "meta": "{\"templateCredsSetupCompleted\":true}",
        "name": "CAPA 2: input_chunk",
        "nodes": "[{\"parameters\":{\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_raw?select=id,raw_text,language&status=neq.procesado\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-600,60],\"id\":\"f542323a-0ee8-44dd-83e3-c40f88b1f0c9\",\"name\":\"CARGAR EMBEDDINGS SUPABASE\",\"credentials\":{\"supabaseApi\":{\"id\":\"LOVa9pAD67DCJ7mo\",\"name\":\"Supabase account\"}}},{\"parameters\":{\"jsCode\":\"return $input.all().map(item => {\\n  return {\\n    raw_id: item.json.id,\\n    lang: item.json.language,\\n    content_clean: item.json.raw_text\\n      .replace(/https?:\\\\/\\\\/\\\\S+/g, '')                 // eliminar URLs\\n      .replace(/\\\\*\\\\*(.*?)\\\\*\\\\*/g, '$1')                // quitar negritas markdown\\n      .replace(/_{3,}/g, '')                          // eliminar líneas tipo \\\"_____\\\"\\n      .replace(/\\\\(.*?cloudflare.*?\\\\)/gi, '')          // comentarios irrelevantes\\n      .replace(/^\\\\s*[-*•]\\\\s*/gm, '')                  // bullets\\n      .replace(/\\\\n{2,}/g, '\\\\n')                       // colapsar saltos múltiples\\n      .trim()\\n  };\\n});\\n\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-380,60],\"id\":\"65b3df5b-c270-4777-a08c-87c154399edf\",\"name\":\"Code1\",\"executeOnce\":false},{\"parameters\":{\"jsCode\":\"return $input.all().map(item => ({\\n  content: item.json.content_clean,\\n  metadata: {\\n    raw_id: item.json.raw_id,\\n    lang: item.json.lang,\\n    length: item.json.content_clean.length,\\n    chunk_index: 0\\n  }\\n}));\\n\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-160,60],\"id\":\"93f5acf6-63c8-4488-979c-53b50066312f\",\"name\":\"Code2\"},{\"parameters\":{},\"type\":\"n8n-nodes-base.manualTrigger\",\"typeVersion\":1,\"position\":[-820,55],\"id\":\"56d71ad8-38bf-4b8c-9f8e-5280929f59e0\",\"name\":\"When clicking ‘Execute workflow’\"},{\"parameters\":{\"mode\":\"insert\",\"tableName\":{\"__rl\":true,\"mode\":\"id\",\"value\":\"input_chunk\"},\"options\":{\"queryName\":\"documents\"}},\"type\":\"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\"typeVersion\":1.3,\"position\":[100,60],\"id\":\"025f0911-8c37-4139-9d85-010514b3d913\",\"name\":\"Supabase Vector Store\",\"credentials\":{\"supabaseApi\":{\"id\":\"LOVa9pAD67DCJ7mo\",\"name\":\"Supabase account\"}}},{\"parameters\":{\"options\":{}},\"type\":\"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\"typeVersion\":1.2,\"position\":[80,320],\"id\":\"348c705c-c793-416c-9312-d11d05e94b1b\",\"name\":\"Embeddings OpenAI\",\"credentials\":{\"openAiApi\":{\"id\":\"4KcNhnfACuLnC6w1\",\"name\":\"OpenAi account\"}}},{\"parameters\":{\"jsonMode\":\"expressionData\",\"jsonData\":\"={{ $('Code2').item.json.content }}\",\"textSplittingMode\":\"custom\",\"options\":{\"metadata\":{\"metadataValues\":[{\"name\":\"metadata\",\"value\":\"={{ $('Code2').item.json.metadata }}\"}]}}},\"type\":\"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\"typeVersion\":1.1,\"position\":[200,320],\"id\":\"bf6bb43c-851f-4a07-b5e0-c16f5d775b24\",\"name\":\"Default Data Loader\"},{\"parameters\":{\"chunkSize\":8000},\"type\":\"@n8n/n8n-nodes-langchain.textSplitterTokenSplitter\",\"typeVersion\":1,\"position\":[300,540],\"id\":\"02fa1323-bcde-49a2-9f00-4fcc6b8c3e4c\",\"name\":\"Token Splitter\"}]",
        "parentFolderId": null,
        "pinData": "{}",
        "settings": "{\"executionOrder\":\"v1\"}",
        "staticData": null,
        "triggerCount": 0,
        "updatedAt": "2025-07-08 17:19:55",
        "versionId": "db3d6a47-3496-43c4-a26d-f1d5b8508026"
    },
    {
        "active": 0,
        "connections": "{\"Code11\":{\"main\":[[{\"node\":\"Code\",\"type\":\"main\",\"index\":0}]]},\"CARGAR EMBEDDINGS SUPABASE2\":{\"main\":[[{\"node\":\"Code11\",\"type\":\"main\",\"index\":0}]]},\"Code\":{\"main\":[[{\"node\":\"Llamada multi_cluster_service1\",\"type\":\"main\",\"index\":0},{\"node\":\"CARGA METADATA\",\"type\":\"main\",\"index\":0}]]},\"Llamada multi_cluster_service1\":{\"main\":[[{\"node\":\"Edit Fields\",\"type\":\"main\",\"index\":0},{\"node\":\"Code1\",\"type\":\"main\",\"index\":0}]]},\"When clicking ‘Execute workflow’\":{\"main\":[[{\"node\":\"Llamada multi_cluster_service\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields\":{\"main\":[[{\"node\":\"Merge1\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields1\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"Code1\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0},{\"node\":\"Edit Fields2\",\"type\":\"main\",\"index\":0}]]},\"Merge\":{\"main\":[[{\"node\":\"Summarize\",\"type\":\"main\",\"index\":0}]]},\"Summarize\":{\"main\":[[{\"node\":\"VALIDATION SCORE\",\"type\":\"main\",\"index\":0}]]},\"Merge1\":{\"main\":[[{\"node\":\"1ª ENTRADA CLUSTER META\",\"type\":\"main\",\"index\":0}]]},\"CARGA METADATA\":{\"main\":[[{\"node\":\"Edit Fields1\",\"type\":\"main\",\"index\":0},{\"node\":\"Merge2\",\"type\":\"main\",\"index\":1}]]},\"VALIDATION SCORE\":{\"main\":[[{\"node\":\"Merge1\",\"type\":\"main\",\"index\":1}]]},\"Edit Fields2\":{\"main\":[[{\"node\":\"Merge2\",\"type\":\"main\",\"index\":0}]]},\"Merge2\":{\"main\":[[{\"node\":\"Edit Fields3\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields3\":{\"main\":[[{\"node\":\"ENTRADA ASSIGN_META\",\"type\":\"main\",\"index\":0}]]}}",
        "createdAt": "2025-06-25 15:44:44.794",
        "id": "lKmMrn4YYazXGUFG",
        "isArchived": 0,
        "meta": "{\"templateCredsSetupCompleted\":true}",
        "name": "CLUSTERING",
        "nodes": "[{\"parameters\":{\"jsCode\":\"return items.map(item => {\\n  const raw = item.json.embedding;\\n\\n  let parsed;\\n  try {\\n    parsed = JSON.parse(raw);\\n    if (!Array.isArray(parsed)) {\\n      throw new Error(\\\"Embedding no es un array\\\");\\n    }\\n  } catch (err) {\\n    throw new Error(\\\"Error al parsear embedding: \\\" + err.message);\\n  }\\n\\n  return {\\n    json: {\\n      id: item.json.chunk_id,\\n      embedding: parsed\\n    }\\n  };\\n});\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[80,995],\"id\":\"dbf94b5c-e44f-49be-9b89-14a30a59539f\",\"name\":\"Code11\"},{\"parameters\":{\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_chunk?select=chunk_id,raw_id,embedding\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-140,995],\"id\":\"442f33d1-2a43-4b15-afdf-3236104b1df4\",\"name\":\"CARGAR EMBEDDINGS SUPABASE2\",\"credentials\":{\"supabaseApi\":{\"id\":\"LOVa9pAD67DCJ7mo\",\"name\":\"Supabase account\"}}},{\"parameters\":{\"jsCode\":\"const level = 'chunk';\\nconst source_table = 'input_chunk';\\nconst reduction = 30;\\n\\nconst transformedItems = $input.all().map(entry => {\\n  return {\\n    input_id: entry.json.id.toString(), // <- esto arregla el 422\\n    embedding: entry.json.embedding,\\n  };\\n});\\n\\nreturn [\\n  {\\n    json: {\\n      level,\\n      source_table,\\n      reduction,\\n      items: transformedItems,\\n    }\\n  }\\n];\\n\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[300,995],\"id\":\"db04ad4e-cab2-407b-8d30-0fd55c34bc93\",\"name\":\"Code\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"http://cluster-service-pro:8000/clusterize\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={{ JSON.stringify($json) }}\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[520,720],\"id\":\"ac2e755f-0555-45c5-9602-580a93c475cd\",\"name\":\"Llamada multi_cluster_service1\",\"executeOnce\":true},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"e1ba8b6c-15df-478f-9891-1a0265167f43\",\"name\":\"source_table\",\"value\":\"=input_chunk\",\"type\":\"string\"},{\"id\":\"417d881d-cfaf-4243-8223-d7eb73c70f19\",\"name\":\"created_by_agent\",\"value\":\"=cluster_service_pro\",\"type\":\"string\"},{\"id\":\"36ae0506-3e96-4a37-9171-32bfc81fd5aa\",\"name\":\"cluster_id\",\"value\":\"={{ $json.cluster_id }}\",\"type\":\"string\"},{\"id\":\"3158c2ac-15bb-4d44-a573-b181e761e603\",\"name\":\"parent_cluster_id\",\"value\":\"={{ $json.parent_cluster_id }}\",\"type\":\"string\"},{\"id\":\"f642ce91-95ba-4bda-aef8-26fe34aa3329\",\"name\":\"depth\",\"value\":\"={{ $json.depth }}\",\"type\":\"number\"},{\"id\":\"1727cfef-83c6-46a5-bb0c-ad0df04a162a\",\"name\":\"cluster_path\",\"value\":\"={{ $json.cluster_path }}\",\"type\":\"string\"},{\"id\":\"f30358eb-d954-44d7-a948-9932b40807e8\",\"name\":\"num_elements\",\"value\":\"={{ $json.num_elements }}\",\"type\":\"number\"},{\"id\":\"4b19d49d-99cc-4549-8651-873597b369a8\",\"name\":\"embedding_avg\",\"value\":\"={{ $json.embedding_avg }}\",\"type\":\"array\"},{\"id\":\"417613ad-cb8b-4cc0-9b9f-01b3128ab219\",\"name\":\"topic_embedding\",\"value\":\"={{ $json.topic_embedding }}\",\"type\":\"array\"},{\"id\":\"af500f32-4716-4889-ac9d-016b94b8924c\",\"name\":\"cohesion_score\",\"value\":\"={{ $json.cohesion_score }}\",\"type\":\"number\"},{\"id\":\"bca6bc7a-5ecc-4dd3-a617-d26f4240422b\",\"name\":\"representative_id\",\"value\":\"={{ $json.representative_id }}\",\"type\":\"number\"},{\"id\":\"34dfeac9-4c35-4ed6-8eaf-01ed375e77e8\",\"name\":\"input_type\",\"value\":\"={{ $json.input_type }}\",\"type\":\"string\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[1400,620],\"id\":\"e2667389-14c8-4d6b-9b41-1e36b627b432\",\"name\":\"Edit Fields\"},{\"parameters\":{},\"type\":\"n8n-nodes-base.manualTrigger\",\"typeVersion\":1,\"position\":[-300,1500],\"id\":\"707845c1-6647-47df-bfd5-c76f63bf5b51\",\"name\":\"When clicking ‘Execute workflow’\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/cluster_meta\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Authorization\",\"value\":\"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"},{\"name\":\"apikey\",\"value\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={{ JSON.stringify($items().map(item => item.json)) }}\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[1840,720],\"id\":\"e1d0c2ce-1977-444b-a408-34d852c9e632\",\"name\":\"1ª ENTRADA CLUSTER META\",\"executeOnce\":true},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"af0764c7-6266-4cc9-b999-70c368b347ec\",\"name\":\"score\",\"value\":\"={{ $json.input_raw.metadata.score }}\",\"type\":\"number\"},{\"id\":\"5834afd3-a831-4924-8673-b73782d9bddc\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[740,1170],\"id\":\"d2ddde4c-b12f-4e35-8b9d-729aa963622c\",\"name\":\"Edit Fields1\"},{\"parameters\":{\"jsCode\":\"const results = [];\\n\\nfor (const item of items) {\\n  const cluster = item.json;\\n\\n  cluster.assigned_ids.forEach((id, position) => {\\n    results.push({\\n      json: {\\n        id,\\n        cluster_id: cluster.cluster_id,\\n        cluster_path: cluster.cluster_path,\\n        position\\n      }\\n    });\\n  });\\n}\\n\\nreturn results;\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[740,870],\"id\":\"945ae871-d2a5-4472-a8de-c4cf827e6c6b\",\"name\":\"Code1\"},{\"parameters\":{\"mode\":\"combine\",\"advanced\":true,\"mergeByFields\":{\"values\":[{\"field1\":\"id\",\"field2\":\"chunk_id\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[960,870],\"id\":\"5a4ec4e2-b415-4830-9c86-2b449208b9b1\",\"name\":\"Merge\"},{\"parameters\":{\"fieldsToSummarize\":{\"values\":[{\"aggregation\":\"average\",\"field\":\"score\"}]},\"fieldsToSplitBy\":\"cluster_id\",\"options\":{}},\"type\":\"n8n-nodes-base.summarize\",\"typeVersion\":1.1,\"position\":[1180,870],\"id\":\"e754bc55-4543-4a36-8018-3314859460da\",\"name\":\"Summarize\"},{\"parameters\":{\"mode\":\"combine\",\"fieldsToMatchString\":\"cluster_id\",\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[1620,720],\"id\":\"d9f08b56-cdff-4b0a-aa07-6adefe5b802f\",\"name\":\"Merge1\"},{\"parameters\":{\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_chunk?select=chunk_id,length,content,chunk_index,input_raw(metadata,source_type)\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[520,1245],\"id\":\"a6d11274-86b9-4e4a-b880-c7b6cfc5db9c\",\"name\":\"CARGA METADATA\",\"credentials\":{\"supabaseApi\":{\"id\":\"LOVa9pAD67DCJ7mo\",\"name\":\"Supabase account\"}}},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"8ed83a4c-e033-4647-ad05-00cfbcd25e74\",\"name\":\"validation_score\",\"value\":\"={{ $json.average_score }}\",\"type\":\"number\"},{\"id\":\"299e46f9-cda6-4cfe-9e64-360d3f7b2017\",\"name\":\"cluster_id\",\"value\":\"={{ $json.cluster_id }}\",\"type\":\"string\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[1400,870],\"id\":\"0b683b73-3773-4c21-b5dd-fd02acf81190\",\"name\":\"VALIDATION SCORE\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"48a8064f-8730-4acb-8375-22b32a2d4ca3\",\"name\":\"chunk_id\",\"value\":\"={{ $json.id }}\",\"type\":\"number\"},{\"id\":\"456542bb-89d4-4b44-b241-df1cc05ddcc5\",\"name\":\"cluster_id\",\"value\":\"={{ $json.cluster_id }}\",\"type\":\"string\"},{\"id\":\"dba80441-5614-49a8-af4d-b2074d320f9a\",\"name\":\"cluster_path\",\"value\":\"={{ $json.cluster_path }}\",\"type\":\"string\"},{\"id\":\"d384ecde-f317-446a-8665-7e92b05c49f4\",\"name\":\"position\",\"value\":\"={{ $json.position }}\",\"type\":\"number\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[960,1070],\"id\":\"80908b9d-052e-4b4d-987d-572d8a571883\",\"name\":\"Edit Fields2\"},{\"parameters\":{\"mode\":\"combine\",\"fieldsToMatchString\":\"chunk_id\",\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[1180,1195],\"id\":\"8c4abc01-74cc-47cd-9672-73652f9fabf2\",\"name\":\"Merge2\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"6a22839c-040d-405c-b32e-c8e4a15c3f95\",\"name\":\"cluster_id\",\"value\":\"={{ $json.cluster_id }}\",\"type\":\"string\"},{\"id\":\"d167fc94-1c38-42bb-a460-d2246920671c\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"},{\"id\":\"6798dc18-ac8d-4d06-9e08-024deaaaa8b8\",\"name\":\"content\",\"value\":\"={{ $json.content }}\",\"type\":\"string\"},{\"id\":\"da1c7132-3fd4-4f62-9419-ff0b84cb1805\",\"name\":\"score\",\"value\":\"={{ $json.input_raw.metadata.score }}\",\"type\":\"number\"},{\"id\":\"e272a7b7-7093-42bd-9677-6fe7ffa9f741\",\"name\":\"length\",\"value\":\"={{ $json.length }}\",\"type\":\"number\"},{\"id\":\"9d20cfca-1294-44e2-bc30-5d1a5e95bae7\",\"name\":\"source_type\",\"value\":\"={{ $json.input_raw.source_type }}\",\"type\":\"string\"},{\"id\":\"7c52ce3a-d2f3-44e3-81ae-1176e7ee7cbf\",\"name\":\"position\",\"value\":\"={{ $json.position }}\",\"type\":\"number\"},{\"id\":\"b48897e0-3921-47a0-bd35-cb85d5ed0ea9\",\"name\":\"cluster_path\",\"value\":\"={{ $json.cluster_path }}\",\"type\":\"string\"},{\"id\":\"06323647-0f3e-4282-9634-b8e3767d4d77\",\"name\":\"chunk_index\",\"value\":\"={{ $json.chunk_index }}\",\"type\":\"string\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[1400,1200],\"id\":\"a70b58f5-c222-4028-912d-78df88466b6c\",\"name\":\"Edit Fields3\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/assign_meta\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Authorization\",\"value\":\"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"},{\"name\":\"apikey\",\"value\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={{ JSON.stringify($items().map(item => item.json)) }}\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[1900,1200],\"id\":\"a0b54f57-b017-4789-a2ae-7486c079a7f9\",\"name\":\"ENTRADA ASSIGN_META\",\"executeOnce\":true},{\"parameters\":{\"method\":\"POST\",\"url\":\"http://cluster_interpreter_service:8000/interpret_cluster\",\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={\\n  \\\"cluster_id\\\": \\\"0592ded0-c656-45b5-9209-33f852a98dfd\\\"\\n}\\n\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-60,1500],\"id\":\"31de90c1-f793-40f4-95ce-b8907e5e377e\",\"name\":\"Llamada multi_cluster_service\",\"executeOnce\":true}]",
        "parentFolderId": null,
        "pinData": "{}",
        "settings": "{\"executionOrder\":\"v1\"}",
        "staticData": null,
        "triggerCount": 0,
        "updatedAt": "2025-07-23 12:24:38",
        "versionId": "18256510-e1b6-4aef-8437-95594f50a2a9"
    },
    {
        "active": 0,
        "connections": "{\"On form submission\":{\"main\":[[{\"node\":\"Move Binary Data\",\"type\":\"main\",\"index\":0},{\"node\":\"Move Binary Data1\",\"type\":\"main\",\"index\":0}]]},\"Move Binary Data\":{\"main\":[[{\"node\":\"Extract from File\",\"type\":\"main\",\"index\":0}]]},\"Extract from File\":{\"main\":[[{\"node\":\"OpenAI\",\"type\":\"main\",\"index\":0}]]},\"OpenAI\":{\"main\":[[{\"node\":\"Edit Fields\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields\":{\"main\":[[{\"node\":\"Create a record\",\"type\":\"main\",\"index\":0}]]},\"ESTRUCTURADOR DE MARCA\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"Merge\":{\"main\":[[{\"node\":\"Create a record1\",\"type\":\"main\",\"index\":0}]]},\"Move Binary Data1\":{\"main\":[[{\"node\":\"Extract from File1\",\"type\":\"main\",\"index\":0}]]},\"Extract from File1\":{\"main\":[[{\"node\":\"ESTRUCTURADOR DE MARCA\",\"type\":\"main\",\"index\":0},{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}]]}}",
        "createdAt": "2025-06-23 20:00:07.165",
        "id": "PqC9qzAE0n6tDSNl",
        "isArchived": 0,
        "meta": "{\"templateCredsSetupCompleted\":true}",
        "name": "ESTRUCTURADOR DE MARCA",
        "nodes": "[{\"parameters\":{\"formTitle\":\"brandFile\",\"formDescription\":\"Arrastra tus documentos\",\"formFields\":{\"values\":[{\"fieldLabel\":\"brandFile\",\"fieldType\":\"file\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.formTrigger\",\"typeVersion\":2.2,\"position\":[-560,60],\"id\":\"67c674c3-868f-4b1f-82eb-d410ed9d6b7c\",\"name\":\"On form submission\",\"webhookId\":\"2a440fc3-71c6-40bc-857f-79bd395ea6aa\"},{\"parameters\":{\"jsCode\":\"return [\\n  {\\n    binary: {\\n      data: items[0].binary.brandFile // cambia \\\"brandFile\\\" si usaste otro nombre en tu formulario\\n    },\\n    json: {}\\n  }\\n];\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-340,-20],\"id\":\"3a071d57-0561-4ae0-bc71-05882d5ab3ce\",\"name\":\"Move Binary Data\"},{\"parameters\":{\"operation\":\"pdf\",\"options\":{}},\"type\":\"n8n-nodes-base.extractFromFile\",\"typeVersion\":1,\"position\":[-140,-20],\"id\":\"f8fd98d4-3309-4f4a-b7e2-9e86d6378c68\",\"name\":\"Extract from File\"},{\"parameters\":{\"modelId\":{\"__rl\":true,\"value\":\"gpt-4o\",\"mode\":\"list\",\"cachedResultName\":\"GPT-4O\"},\"messages\":{\"values\":[{\"content\":\"Eres un planner estratégico de alto nivel especializado en campañas de comunicación. Actúas como un analista que trabaja con planners y creativos en una agencia de publicidad. Tu tarea es analizar documentos internos de marca (briefs, textos, páginas web, PDFs, etc.) y extraer con rigor los elementos clave del diagnóstico estratégico.\\n\\nEsta es la primera fase de cualquier campaña: identificar el problema u oportunidad, establecer objetivos de comunicación y definir el público objetivo. Tu trabajo **no es generar ideas**, ni aportar creatividad, ni reformular de forma libre. Tu trabajo es **detectar, estructurar y sintetizar con precisión lo que ya está dicho o claramente sugerido**.\\n\\n### Tu comportamiento debe ser:\\n- **Nivel de creatividad: 10% máximo.** Solo puedes inferir si hay evidencias claras (por ejemplo, si un problema está sugerido pero no nombrado literalmente).\\n- **Rigor analítico absoluto.** Evita adornos, no reinterpretes. No rellenes vacíos con tuposiciones.\\n- **Formato obligatorio: JSON estructurado.** No entregues texto adicional ni explicaciones fuera del JSON.\\n- **Coherencia estructural:** Sigue exactamente la estructura que se te indica. No modifiques claves. No cambies tipos de datos.\\n\\nPiensa como un profesional que trabaja para que otros humanos (copywriters, diseñadores, directores de arte) puedan actuar con claridad a partir de lo que tú extraes.\\n\\nSi el texto no incluye una información, devuélvela como campo vacío (`\\\"\\\"` o `[]`) pero nunca inventes contenido.\\n\\nEl objetivo final es que otros agentes IA puedan trabajar sobre este diagnóstico como si fuera un brief confiable.\\n\",\"role\":\"system\"},{\"content\":\"=Analiza el siguiente texto. Extrae los elementos clave de la fase 1 del proceso creativo de campaña:\\n\\nTexto:{{ $json.text }}\\nDevuelve un único objeto JSON con esta estructura exacta (no modifiques nombres, tipos ni formato):\\n\\n{\\n  \\\"nombre_marca\\\"\\n  \\\"problema_oportunidad\\\": \\\"\\\",\\n  \\\"insight_detectado\\\": \\\"\\\",\\n  \\\"objetivos_comunicacion\\\": {\\n    \\\"especifico\\\": \\\"\\\",\\n    \\\"medible\\\": \\\"\\\",\\n    \\\"alcanzable\\\": \\\"\\\",\\n    \\\"relevante\\\": \\\"\\\",\\n    \\\"tiempo\\\": \\\"\\\"\\n  },\\n  \\\"alineacion_estrategica\\\": \\\"\\\",\\n  \\\"publico_objetivo\\\": {\\n    \\\"descripcion_general\\\": \\\"\\\",\\n    \\\"segmentos\\\": [],\\n    \\\"necesidades\\\": \\\"\\\",\\n    \\\"percepcion_actual\\\": \\\"\\\"\\n  },\\n  \\\"mensaje_clave\\\": \\\"\\\",\\n  \\\"ejemplo_sintetico\\\": \\\"\\\"\\n}\\n\"}]},\"jsonOutput\":true,\"options\":{}},\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"typeVersion\":1.8,\"position\":[80,-20],\"id\":\"98461e2d-e561-4cb5-9a65-b846f87f91f2\",\"name\":\"OpenAI\",\"credentials\":{\"openAiApi\":{\"id\":\"4KcNhnfACuLnC6w1\",\"name\":\"OpenAi account\"}}},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"ef647623-6e88-47c9-b2d5-d603922a99f1\",\"name\":\"message.content.objetivos_comunicacion\",\"value\":\"={{ $json.message.content.objetivos_comunicacion }}\",\"type\":\"string\"},{\"id\":\"33720055-b523-4d6a-b0f9-6e8056559f8a\",\"name\":\"message.content.publico_objetivo\",\"value\":\"={{ $json.message.content.publico_objetivo }}\",\"type\":\"string\"}]},\"includeOtherFields\":true,\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[420,-20],\"id\":\"018973a5-94d5-46f3-861f-6011123c4c23\",\"name\":\"Edit Fields\"},{\"parameters\":{\"content\":\"1. Identificación de la necesidad y definición de objetivos\\nToda campaña comienza con la identificación del problema u oportunidad de comunicación que la marca necesita abordar. La marca (anunciante) se reúne con su equipo de marketing o con una agencia publicitaria para plantear dicha necesidad.\\n\\nEn esta instancia inicial se define claramente el problema que la campaña debe resolver (p. ej., “poca conciencia de la marca en cierto segmento” o “necesidad de cambiar una percepción del público”). Asimismo, se establecen los objetivos concretos de la campaña, es decir, lo que se espera lograr en términos de comunicación. Por ejemplo, el objetivo puede ser incrementar el reconocimiento de la marca en determinado porcentaje o generar concienciación sobre un beneficio del producto.\\n\\nEs fundamental que los objetivos sigan criterios SMART (específicos, medibles, alcanzables, relevantes y definidos en el tiempo) y que estén alineados con la estrategia de negocio. Paralelamente, se delimita el público objetivo o audiencia clave a la que se dirigirá la campaña (edad, género, intereses, etc.), ya que conocer a quién nos dirigimos guiará todas las decisiones posteriores. Toda esta información inicial se documenta y estructura para darle forma al siguiente paso, el brief creativo. En resumen, en esta etapa inicial se responde al qué se quiere comunicar, a quién y para qué.\\n\\nUn ejemplo podría ser: una marca de alimentos identifica que su público joven no la percibe como moderna; el objetivo entonces será aumentar la conciencia de marca en jóvenes, comunicando un atributo novedoso del producto.\",\"height\":120,\"width\":600},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-500,-220],\"typeVersion\":1,\"id\":\"c7f41f68-e2ac-4c9b-9e1a-b140d2a1f737\",\"name\":\"Sticky Note\"},{\"parameters\":{\"modelId\":{\"__rl\":true,\"value\":\"gpt-4o\",\"mode\":\"list\",\"cachedResultName\":\"GPT-4O\"},\"messages\":{\"values\":[{\"content\":\"Actúas como analista estratégico de marca especializado en identidad verbal, posicionamiento narrativo y tono.  \\nTu misión es leer cualquier documento de marca (manifiestos, propósitos, guías, webs, fichas de producto, etc.) y extraer una ficha estructurada que condense toda la información clave —explícita e implícita— necesaria para generar contenido coherente con la marca.\\n\\nCriterios de análisis:\\n- Registra con precisión todo lo que esté claramente presente.\\n- Deduce únicamente lo implícito que sea evidente para un experto en branding.\\n- No inventes, no rellenes con generalidades vacías.\\n- Si no hay información suficiente, deja el campo vacío con `\\\"\\\"`.\\n- Devuelve exactamente seis campos, sin estructuras internas, sin listas ni subniveles.\\n\\nFormato de salida:\\nDevuelve **solo un bloque JSON plano** con exactamente los siguientes seis campos.  \\n**Cada campo debe ser un texto completo y coherente que condense toda la información que se indica:**\\n\\n```json\\n{\\n  \\\"Nombre de marca\\\": \\\"\\\",\\n\\n  \\\"Identidad base\\\": \\\"\\\",  // Describe: producto principal, propósito transformador, valores clave, estado de la marca, buyer persona, motivaciones principales, objeciones típicas, nivel de conciencia, insight activador del buyer\\n\\n  \\\"Voz y tono\\\": \\\"\\\",  // Describe: tono primario y secundario, tono prohibido, nivel de formalidad, registro emocional, tipo de voz narrativa, lenguaje aspiracional o de pertenencia, vocabulario propio o expresiones clave, palabras prohibidas\\n\\n  \\\"Narrativa estratégica\\\": \\\"\\\",  // Describe: arquetipo de marca, contraposición principal (qué combate o rechaza la marca), rol simbólico en el sector, tono cultural general, universo simbólico o imaginería clave, referencias culturales explícitas, temas sensibles a evitar, disclaimers obligatorios\\n\\n  \\\"Dirección editorial\\\": \\\"\\\",  // Describe: impresión visual buscada, estéticas rechazadas, paleta de colores si aparece, tipografías, recursos gráficos frecuentes, líneas narrativas recomendadas o recurrentes\\n\\n  \\\"Producto\\\": \\\"\\\"  // Describe: nombre del producto, beneficios funcionales, beneficios emocionales, diferenciadores clave, metáfora o storytelling del producto, objeciones frecuentes específicas del producto\\n}\\n\"},{\"content\":\"={{ $json.text }}\"}]},\"jsonOutput\":true,\"options\":{}},\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"typeVersion\":1.8,\"position\":[80,160],\"id\":\"30cbd056-0be7-4f82-84ca-c18ec1a64996\",\"name\":\"ESTRUCTURADOR DE MARCA\",\"credentials\":{\"openAiApi\":{\"id\":\"4KcNhnfACuLnC6w1\",\"name\":\"OpenAi account\"}}},{\"parameters\":{\"mode\":\"combine\",\"combineBy\":\"combineByPosition\",\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.1,\"position\":[420,160],\"id\":\"7f0b4258-84e2-49f8-acbe-cafaf8dd902f\",\"name\":\"Merge\"},{\"parameters\":{\"jsCode\":\"return [\\n  {\\n    binary: {\\n      data: items[0].binary.brandFile // cambia \\\"brandFile\\\" si usaste otro nombre en tu formulario\\n    },\\n    json: {}\\n  }\\n];\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-340,160],\"id\":\"0eacd7c9-83ef-449c-b46c-b67b4ce02589\",\"name\":\"Move Binary Data1\"},{\"parameters\":{\"operation\":\"pdf\",\"options\":{}},\"type\":\"n8n-nodes-base.extractFromFile\",\"typeVersion\":1,\"position\":[-140,160],\"id\":\"6435a74a-1ffe-461c-a78d-41d989f45abe\",\"name\":\"Extract from File1\"},{\"parameters\":{\"content\":\"1. Extracción de la personalidad de marca.\\nToda construcción coherente de marca comienza con una necesidad clara: entender quién es la marca antes de comunicar qué quiere decir. En esta primera instancia se activa el Extractor de Personalidad de Marca, una herramienta diseñada para identificar, ordenar y documentar los elementos esenciales que configuran su identidad y su forma de expresarse.\\n\\nEl objetivo es detectar posibles inconsistencias, definir un marco estratégico y sentar las bases para cualquier acción posterior: desde una campaña puntual hasta la producción continua de contenidos.\\n\\nPara ello, el extractor se estructura en cinco bloques principales:\\n\\nIdentidad base\\nSe definen los principios fundamentales que sostienen a la marca: su visión, valores, territorio simbólico y posicionamiento. Este bloque responde al quién soy y por qué existo como marca.\\n\\nVoz y tono\\nAquí se establecen las reglas expresivas de la marca: cómo suena, qué rasgos lingüísticos la definen, qué modula según canal o audiencia. Permite mantener coherencia en cualquier texto o pieza de comunicación.\\n\\nNarrativa estratégica\\nEste eje articula la historia que la marca debe contar. Incluye el relato fundacional, las tensiones que enfrenta, los símbolos que activa y el arco argumental que sostiene su propuesta de valor.\\n\\nDirección editorial\\nDelimita los temas sobre los que la marca puede o debe hablar. Se identifican ejes discursivos, líneas temáticas y criterios para decidir qué contenido es relevante, y cuál no.\\n\\nProducto\\nSe analiza el producto o servicio no solo como solución funcional, sino como portador de significado. ¿Qué dice el producto de la marca? ¿Qué refuerza o contradice de todo lo anterior?\\n\\nTodo este proceso se documenta en un informe claro y accionable que sirve como punto de partida para diseñar el sistema de comunicación de marca. En esta etapa inicial, en definitiva, se responde al qué es la marca, cómo se expresa y desde qué relato construye sentido.\",\"height\":120,\"width\":680},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[140,-220],\"typeVersion\":1,\"id\":\"46f51065-d310-436f-8eb1-626adaede845\",\"name\":\"Sticky Note1\"},{\"parameters\":{\"operation\":\"create\",\"base\":{\"__rl\":true,\"value\":\"appAB8jzf6tFQ9O6G\",\"mode\":\"list\",\"cachedResultName\":\"CONTEXTO ESTRUCTURAL\",\"cachedResultUrl\":\"https://airtable.com/appAB8jzf6tFQ9O6G\"},\"table\":{\"__rl\":true,\"value\":\"tblEHJgaJdW2BieTq\",\"mode\":\"list\",\"cachedResultName\":\"FASE 1\",\"cachedResultUrl\":\"https://airtable.com/appAB8jzf6tFQ9O6G/tblEHJgaJdW2BieTq\"},\"columns\":{\"mappingMode\":\"defineBelow\",\"value\":{\"problema_oportunidad\":\"={{ $json.message.content.problema_oportunidad }}\",\"insight_detectado\":\"={{ $json.message.content.insight_detectado }}\",\"objetivos comunicacion\":\"={{ $json.message.content.objetivos_comunicacion }}\",\"alineacion_estrategica\":\"={{ $json.message.content.alineacion_estrategica }}\",\"publico_objetivo\":\"={{ $json.message.content.publico_objetivo }}\",\"mensaje _clave\":\"={{ $json.message.content.mensaje_clave }}\",\"ejemplo_sintetico\":\"={{ $json.message.content.ejemplo_sintetico }}\",\"MARCA\":\"={{ $json.message.content.nombre_marca }}\"},\"matchingColumns\":[],\"schema\":[{\"id\":\"MARCA\",\"displayName\":\"MARCA\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"problema_oportunidad\",\"displayName\":\"problema_oportunidad\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"insight_detectado\",\"displayName\":\"insight_detectado\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"objetivos comunicacion\",\"displayName\":\"objetivos comunicacion\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"alineacion_estrategica\",\"displayName\":\"alineacion_estrategica\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"publico_objetivo\",\"displayName\":\"publico_objetivo\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"mensaje _clave\",\"displayName\":\"mensaje _clave\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"ejemplo_sintetico\",\"displayName\":\"ejemplo_sintetico\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false}],\"attemptToConvertTypes\":false,\"convertFieldsToString\":false},\"options\":{}},\"type\":\"n8n-nodes-base.airtable\",\"typeVersion\":2.1,\"position\":[600,-20],\"id\":\"84ee707d-35f2-4b6c-9051-fbb057ec0c28\",\"name\":\"Create a record\",\"credentials\":{\"airtableTokenApi\":{\"id\":\"lqu9XctzSFzvXG3z\",\"name\":\"Airtable Personal Access Token account\"}}},{\"parameters\":{\"operation\":\"create\",\"base\":{\"__rl\":true,\"value\":\"https://airtable.com/appAB8jzf6tFQ9O6G/tblSiNqnBYkCVgRkD/viwhBsVhoK2FncFN3\",\"mode\":\"url\"},\"table\":{\"__rl\":true,\"value\":\"tblSiNqnBYkCVgRkD\",\"mode\":\"list\",\"cachedResultName\":\"Table 1\",\"cachedResultUrl\":\"https://airtable.com/appAB8jzf6tFQ9O6G/tblSiNqnBYkCVgRkD\"},\"columns\":{\"mappingMode\":\"defineBelow\",\"value\":{\"Name\":\"={{ $json.message.content[\\\"Nombre de marca\\\"] }}\",\"IDENTIDAD BASE\":\"={{ $json.message.content[\\\"Identidad base\\\"] }}\",\"VOZ Y TONO\":\"={{ $json.message.content[\\\"Voz y tono\\\"] }}\",\"NARRATIVA ESTRATEGICA\":\"={{ $json.message.content[\\\"Narrativa estratégica\\\"] }}\",\"DIRECCION EDITORIAL\":\"={{ $json.message.content[\\\"Dirección editorial\\\"] }}\",\"PRODUCTO\":\"={{ $json.message.content.Producto }}\",\"TEXTO MARCA\":\"={{ $json.text }}\"},\"matchingColumns\":[],\"schema\":[{\"id\":\"Name\",\"displayName\":\"Name\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"TEXTO MARCA\",\"displayName\":\"TEXTO MARCA\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"IDENTIDAD BASE\",\"displayName\":\"IDENTIDAD BASE\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"VOZ Y TONO\",\"displayName\":\"VOZ Y TONO\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"NARRATIVA ESTRATEGICA\",\"displayName\":\"NARRATIVA ESTRATEGICA\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"DIRECCION EDITORIAL\",\"displayName\":\"DIRECCION EDITORIAL\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false},{\"id\":\"PRODUCTO\",\"displayName\":\"PRODUCTO\",\"required\":false,\"defaultMatch\":false,\"canBeUsedToMatch\":true,\"display\":true,\"type\":\"string\",\"readOnly\":false,\"removed\":false}],\"attemptToConvertTypes\":false,\"convertFieldsToString\":false},\"options\":{}},\"type\":\"n8n-nodes-base.airtable\",\"typeVersion\":2.1,\"position\":[600,160],\"id\":\"792f0eb5-33f6-40d0-9d39-24a1ebd3d884\",\"name\":\"Create a record1\",\"credentials\":{\"airtableTokenApi\":{\"id\":\"lqu9XctzSFzvXG3z\",\"name\":\"Airtable Personal Access Token account\"}}}]",
        "parentFolderId": null,
        "pinData": "{}",
        "settings": "{\"executionOrder\":\"v1\"}",
        "staticData": null,
        "triggerCount": 0,
        "updatedAt": "2025-06-24 08:54:41",
        "versionId": "b0c4a4f4-9375-4d59-aaf3-55abdf500e2b"
    },
    {
        "active": 0,
        "connections": "{\"Remove Duplicates1\":{\"main\":[[{\"node\":\"Sort1\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields12\":{\"main\":[[{\"node\":\"Message a model2\",\"type\":\"main\",\"index\":0}]]},\"HTTP Request1\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}]]},\"Get Posts3\":{\"main\":[[{\"node\":\"Edit Fields19\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields19\":{\"main\":[[{\"node\":\"Remove Duplicates1\",\"type\":\"main\",\"index\":0}]]},\"Sort1\":{\"main\":[[{\"node\":\"Filter1\",\"type\":\"main\",\"index\":0}]]},\"Filter1\":{\"main\":[[{\"node\":\"Code4\",\"type\":\"main\",\"index\":0}]]},\"Code4\":{\"main\":[[{\"node\":\"Edit Fields21\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields21\":{\"main\":[[{\"node\":\"Code\",\"type\":\"main\",\"index\":0}]]},\"Search records\":{\"main\":[[{\"node\":\"Edit Fields12\",\"type\":\"main\",\"index\":0}]]},\"Code\":{\"main\":[[{\"node\":\"Summarize\",\"type\":\"main\",\"index\":0},{\"node\":\"CAPA 1 SUPABASE\",\"type\":\"main\",\"index\":0}]]},\"Message a model2\":{\"main\":[[{\"node\":\"HTTP Request1\",\"type\":\"main\",\"index\":0},{\"node\":\"HTTP Request\",\"type\":\"main\",\"index\":0},{\"node\":\"HTTP Request2\",\"type\":\"main\",\"index\":0},{\"node\":\"HTTP Request3\",\"type\":\"main\",\"index\":0},{\"node\":\"HTTP Request4\",\"type\":\"main\",\"index\":0}]]},\"When clicking ‘Execute workflow’\":{\"main\":[[{\"node\":\"Search records\",\"type\":\"main\",\"index\":0}]]},\"HTTP Request\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"HTTP Request2\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":2}]]},\"HTTP Request4\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":3}]]},\"HTTP Request3\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":4}]]},\"Merge\":{\"main\":[[{\"node\":\"Code2\",\"type\":\"main\",\"index\":0}]]},\"Code2\":{\"main\":[[{\"node\":\"Filter2\",\"type\":\"main\",\"index\":0}]]},\"Filter2\":{\"main\":[[{\"node\":\"Get Posts3\",\"type\":\"main\",\"index\":0}]]}}",
        "createdAt": "2025-06-23 20:02:46.520",
        "id": "0XG7K4DHnnAzzNtI",
        "isArchived": 0,
        "meta": "{\"templateCredsSetupCompleted\":true}",
        "name": "CAPA 1: input_raw",
        "nodes": "[{\"parameters\":{\"compare\":\"selectedFields\",\"fieldsToCompare\":\"ID\",\"options\":{}},\"type\":\"n8n-nodes-base.removeDuplicates\",\"typeVersion\":2,\"position\":[-6124,640],\"id\":\"cdb73125-0133-4ad6-9973-be727c7dcbc7\",\"name\":\"Remove Duplicates1\"},{\"parameters\":{\"content\":\"Investigación de mercado y del consumidor: entender las tendencias del mercado y conocer a fondo al consumidor objetivo. Se analizan sus motivaciones, necesidades, percepciones y hábitos. Métodos cualitativos como entrevistas en profundidad y focus groups suelen usarse para obtener insights del consumidor de primera mano. Un focus group (grupo focal) es una reunión con un grupo de personas guiada por un moderador, que permite obtener opiniones, ideas o sugerencias sobre un tema determinado\\nPor ejemplo, se puede reunir a consumidores típicos de la categoría para discutir sus sentimientos sobre la marca o el problema identificado, extrayendo ideas valiosas de sus comentarios. A partir de estas técnicas cualitativas se elabora un listado de insights o verdades del consumidor que podrían inspirar la campaña\",\"height\":180,\"width\":900},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-8560,260],\"typeVersion\":1,\"id\":\"e01a2896-b077-48e1-bff9-ca08ccd5e773\",\"name\":\"Sticky Note14\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"fca67e34-1c8b-41eb-8aba-438b592da167\",\"name\":\"IDENTIDAD BASE\",\"value\":\"={{ $json[\\\"IDENTIDAD BASE\\\"] }}\",\"type\":\"string\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-8040,640],\"id\":\"9fc5db55-631e-40f9-b5db-4e0dccb2987b\",\"name\":\"Edit Fields12\"},{\"parameters\":{\"url\":\"=https://www.reddit.com/subreddits/search.json?q={{ $json.message.content.general_sector }}&limit=2\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-7444,240],\"id\":\"7b983047-cbff-4a42-962e-091e5ec5ea38\",\"name\":\"HTTP Request1\"},{\"parameters\":{\"operation\":\"getAll\",\"subreddit\":\"={{ $json.subreddit }}\",\"filters\":{\"category\":\"hot\"}},\"id\":\"eea158f3-fe57-4882-a984-a16e9ff9d93a\",\"name\":\"Get Posts3\",\"type\":\"n8n-nodes-base.reddit\",\"position\":[-6564,640],\"typeVersion\":1,\"credentials\":{\"redditOAuth2Api\":{\"id\":\"lBLSOqN4cKsBqUX5\",\"name\":\"Reddit account\"}}},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"9b9cd9fd-79b5-4ba6-b98f-484d5687e6b4\",\"name\":\"ID\",\"value\":\"={{ $json.id }}\",\"type\":\"string\"},{\"id\":\"a4251a04-057b-4cf6-95d8-74e34df46790\",\"name\":\"subreddit\",\"value\":\"={{ $json.subreddit }}\",\"type\":\"string\"},{\"id\":\"42ccacf4-d286-40e9-9dd1-e3651efed646\",\"name\":\"title\",\"value\":\"={{ $json.title }}\",\"type\":\"string\"},{\"id\":\"0cdbeadb-5ba2-47db-b7fe-06b373275a25\",\"name\":\"subreddit_subscribers\",\"value\":\"={{ $json.subreddit_subscribers }}\",\"type\":\"number\"},{\"id\":\"1dfc65c9-5da8-41e9-9176-aaaac30359f9\",\"name\":\"upvote_ratio\",\"value\":\"={{ $json.upvote_ratio }}\",\"type\":\"number\"},{\"id\":\"80304117-4208-44af-9eb7-47271fc972f7\",\"name\":\"ups\",\"value\":\"={{ $json.ups }}\",\"type\":\"number\"},{\"id\":\"ab1e8109-0bf5-4212-afef-7b4fe65767bc\",\"name\":\"score\",\"value\":\"={{ $json.score }}\",\"type\":\"number\"},{\"id\":\"bbb5c5e8-1479-41b3-94fe-90e6daf15d94\",\"name\":\"selftext\",\"value\":\"={{ $json.selftext }}\",\"type\":\"string\"},{\"id\":\"7b02ac4d-b176-440b-bd1b-391d164f08e2\",\"name\":\"created_utc\",\"value\":\"={{ $json.created_utc }}\",\"type\":\"number\"},{\"id\":\"a449bac8-f365-4636-a6e9-a6cf2319d717\",\"name\":\"num_comments\",\"value\":\"={{ $json.num_comments }}\",\"type\":\"number\"},{\"id\":\"bf17c57d-2c76-4b78-a753-9fe7ec2b3b06\",\"name\":\"permalink\",\"value\":\"={{ $json.permalink }}\",\"type\":\"string\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-6344,640],\"id\":\"abe61c40-92bf-4605-a8f3-42ca044705c1\",\"name\":\"Edit Fields19\"},{\"parameters\":{\"sortFieldsUi\":{\"sortField\":[{\"fieldName\":\"subreddit\"},{\"fieldName\":\"title\"},{\"fieldName\":\"score\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.sort\",\"typeVersion\":1,\"position\":[-5904,640],\"id\":\"691ebe05-f9d9-4362-a8e1-0f0acab31ead\",\"name\":\"Sort1\"},{\"parameters\":{\"conditions\":{\"options\":{\"caseSensitive\":true,\"leftValue\":\"\",\"typeValidation\":\"strict\",\"version\":2},\"conditions\":[{\"id\":\"119fdc84-b947-4b12-9b62-20a704948d85\",\"leftValue\":\"={{ $json.selftext }}\",\"rightValue\":\"\",\"operator\":{\"type\":\"string\",\"operation\":\"notEmpty\",\"singleValue\":true}}],\"combinator\":\"and\"},\"options\":{}},\"type\":\"n8n-nodes-base.filter\",\"typeVersion\":2.2,\"position\":[-5684,640],\"id\":\"7b69b0af-a6fc-4d8e-a448-bbc8b1e2f1c6\",\"name\":\"Filter1\"},{\"parameters\":{\"jsCode\":\"// Entrada: array de items\\nreturn items.map(item => {\\n  const rawText = item.json.selftext || \\\"\\\";\\n\\n  const cleanText = rawText\\n    .replace(/<[^>]*>/g, '')                     // HTML\\n    .replace(/&[a-z]+;/gi, '')                   // Entidades\\n    .replace(/([\\\\u2700-\\\\u27BF]|[\\\\uE000-\\\\uF8FF]|[\\\\uD800-\\\\uDFFF]|[\\\\uFE00-\\\\uFE0F])/g, '') // Emojis y símbolos\\n    .replace(/[-–—]\\\\s?\\\\w{2,20}$/gm, '')          // Firmas\\n    .replace(/\\\\s+/g, ' ')                        // Espacios extra\\n    .replace(/([!?.,]){2,}/g, '$1')              // Puntuación repetida\\n    .trim();\\n\\n  return {\\n    json: {\\n      ...item.json,\\n      cleanText,\\n    }\\n  };\\n});\\n\\n\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-5464,640],\"id\":\"5f35549e-e1ca-42c4-9e7a-765f1ddfd0fa\",\"name\":\"Code4\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"fdacf721-a6ff-4a64-9255-e11468d15abc\",\"name\":\"ID\",\"value\":\"={{ $json.ID }}\",\"type\":\"string\"},{\"id\":\"cacbdf21-5367-4218-9624-3b15f0414221\",\"name\":\"title\",\"value\":\"={{ $json.title }}\",\"type\":\"string\"},{\"id\":\"bbe5471c-af1c-4d82-bd8a-f02b0b8b82a7\",\"name\":\"cleanText\",\"value\":\"={{ $json.cleanText }}\",\"type\":\"string\"},{\"id\":\"0c7d646d-2a41-4ecf-a9c3-4d9dc4c009a4\",\"name\":\"subreddit\",\"value\":\"={{ $json.subreddit }}\",\"type\":\"string\"},{\"id\":\"8b733aa8-3a48-409f-a5c4-887386ba215f\",\"name\":\"subreddit_subscribers\",\"value\":\"={{ $json.subreddit_subscribers }}\",\"type\":\"number\"},{\"id\":\"e680ade7-f124-4f66-abff-56bdd00754a5\",\"name\":\"upvote_ratio\",\"value\":\"={{ $json.upvote_ratio }}\",\"type\":\"number\"},{\"id\":\"8d4e4c6e-32e1-48ca-a7aa-c7db4cd91b49\",\"name\":\"ups\",\"value\":\"={{ $json.ups }}\",\"type\":\"number\"},{\"id\":\"824f0c4f-cfd6-43e3-bf84-7c55775a043a\",\"name\":\"score\",\"value\":\"={{ $json.score }}\",\"type\":\"number\"},{\"id\":\"718ee57e-37df-4f54-a704-58c60bb989dd\",\"name\":\"created_utc\",\"value\":\"={{ $json.created_utc }}\",\"type\":\"number\"},{\"id\":\"45ef2b71-ccd1-4db9-84c0-a4d23ab877a0\",\"name\":\"num_comments\",\"value\":\"={{ $json.num_comments }}\",\"type\":\"number\"},{\"id\":\"196fd0a5-8049-4734-896a-ccb3dafbed15\",\"name\":\"permalink\",\"value\":\"={{ $json.permalink }}\",\"type\":\"string\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-5244,640],\"id\":\"24ce9c98-1cfc-4a91-8a2d-482cf0142d82\",\"name\":\"Edit Fields21\"},{\"parameters\":{\"content\":\"## KEYWORDS MARCA\",\"height\":260,\"width\":320},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-7852,540],\"typeVersion\":1,\"id\":\"f7a61159-1591-4541-9c5d-f592bd15a2ca\",\"name\":\"Sticky Note16\"},{\"parameters\":{\"content\":\"## BÚSQUEDA SUBREDDITS\",\"height\":260,\"width\":220},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-7504,140],\"typeVersion\":1,\"id\":\"1d14e95f-9e8a-4a41-8127-8a0ee11e14f0\",\"name\":\"Sticky Note17\"},{\"parameters\":{\"content\":\"## GET SUBREDDITS\",\"height\":260,\"width\":220},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-6844,540],\"typeVersion\":1,\"id\":\"d1e1be6c-fecd-4202-95d4-fe17241504ab\",\"name\":\"Sticky Note18\"},{\"parameters\":{\"operation\":\"search\",\"base\":{\"__rl\":true,\"value\":\"appAB8jzf6tFQ9O6G\",\"mode\":\"list\",\"cachedResultName\":\"CONTEXTO ESTRUCTURAL\",\"cachedResultUrl\":\"https://airtable.com/appAB8jzf6tFQ9O6G\"},\"table\":{\"__rl\":true,\"value\":\"tblSiNqnBYkCVgRkD\",\"mode\":\"list\",\"cachedResultName\":\"INFORMACION ESTRUCTURAL\",\"cachedResultUrl\":\"https://airtable.com/appAB8jzf6tFQ9O6G/tblSiNqnBYkCVgRkD\"},\"options\":{}},\"type\":\"n8n-nodes-base.airtable\",\"typeVersion\":2.1,\"position\":[-8260,640],\"id\":\"03fb81d2-9f28-434c-9c3f-f2426af3b15a\",\"name\":\"Search records\",\"credentials\":{\"airtableTokenApi\":{\"id\":\"lqu9XctzSFzvXG3z\",\"name\":\"Airtable Personal Access Token account\"}}},{\"parameters\":{\"jsCode\":\"return items.map(item => {\\n  const data = item.json;\\n\\n  const raw_text = `${data.title}\\\\n\\\\n${data.cleanText}`.trim();\\n\\n  return {\\n    json: {\\n      raw_text: raw_text,\\n      source_type: 'reddit',\\n      source_name: `${data.subreddit}_${data.ID}`,\\n      chunk_index: 0,\\n      language: 'en',\\n      status: 'pendiente',\\n      metadata: {\\n        subreddit: data.subreddit,\\n        subreddit_subscribers: data.subreddit_subscribers,\\n        upvote_ratio: data.upvote_ratio,\\n        ups: data.ups,\\n        score: data.score,\\n        num_comments: data.num_comments,\\n        permalink: data.permalink,\\n        reddit_id: data.ID,\\n        created_utc: data.created_utc\\n      },\\n      created_at: new Date().toISOString()\\n    \\n    }\\n  };\\n});\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-5024,640],\"id\":\"f1b0f5a1-8b4b-4b60-97ab-724768e3c96c\",\"name\":\"Code\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_raw\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Authorization\",\"value\":\"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"},{\"name\":\"apikey\",\"value\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={{ JSON.stringify($items().map(item => item.json)) }}\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-4804,740],\"id\":\"d9dbf105-a4d2-4543-819f-f0a37050f65b\",\"name\":\"CAPA 1 SUPABASE\",\"executeOnce\":true,\"onError\":\"continueErrorOutput\"},{\"parameters\":{\"content\":\"## input_raw\",\"height\":240,\"color\":3},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-5974,560],\"typeVersion\":1,\"id\":\"7f7662f6-fc11-4f01-89a1-dbd91518d2ee\",\"name\":\"Sticky Note\"},{\"parameters\":{\"modelId\":{\"__rl\":true,\"value\":\"gpt-4o\",\"mode\":\"list\",\"cachedResultName\":\"GPT-4O\"},\"messages\":{\"values\":[{\"content\":\"You are a semantic extractor.\\n\\nYour job is to analyze a short product description and return all the terms in English:\\n\\n- \\\"general_sector\\\": a broad category the product belongs to (1 -2  words)\\n- \\\"specific_sector\\\": a more specific subcategory (1 or 2 words).\\n- \\\"keyword1\\\":relevant keywords (each 1 to 3 words max) that could be used as search terms. Do not use full sentences.\\n- \\\"keyword2\\\":relevant keywords (each 1 to 3 words max) that could be used as search terms. Do not use full sentences.\\n- \\\"keyword3\\\":relevant keywords (each 1 to 3 words max) that could be used as search terms. Do not use full sentences.\\n\\nOutput only a clean JSON object with those three keys.\",\"role\":\"system\"},{\"content\":\"={{ $json[\\\"IDENTIDAD BASE\\\"] }}\\n\\n\"}]},\"jsonOutput\":true,\"options\":{\"n\":1,\"temperature\":1}},\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"typeVersion\":1.8,\"position\":[-7820,640],\"id\":\"c50b77af-94e8-4d60-a254-e0bfc0390be1\",\"name\":\"Message a model2\",\"executeOnce\":true,\"credentials\":{\"openAiApi\":{\"id\":\"4KcNhnfACuLnC6w1\",\"name\":\"OpenAi account\"}}},{\"parameters\":{},\"type\":\"n8n-nodes-base.manualTrigger\",\"typeVersion\":1,\"position\":[-8480,640],\"id\":\"09d6cb2e-d429-41ef-b0a7-d4aa1cff4bbb\",\"name\":\"When clicking ‘Execute workflow’\"},{\"parameters\":{\"url\":\"=https://www.reddit.com/subreddits/search.json?q={{ $json.message.content.specific_sector }}&limit=5\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-7444,440],\"id\":\"c4569240-42c4-42df-b471-9ad7bd352c17\",\"name\":\"HTTP Request\"},{\"parameters\":{\"url\":\"=https://www.reddit.com/subreddits/search.json?q={{ $json.message.content.keyword1 }}&limit=1\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-7444,640],\"id\":\"75a2bb9b-4862-487a-9eed-ff5641c32584\",\"name\":\"HTTP Request2\"},{\"parameters\":{\"url\":\"=https://www.reddit.com/subreddits/search.json?q={{ $json.message.content.keyword3 }}&limit=1\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-7444,1040],\"id\":\"471f95f5-7e25-4319-a8de-370281e2180b\",\"name\":\"HTTP Request3\"},{\"parameters\":{\"url\":\"=https://www.reddit.com/subreddits/search.json?q={{ $json.message.content.keyword1 }}&limit=1\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-7444,840],\"id\":\"f0d8c820-a7e1-498e-be38-3217909d42b7\",\"name\":\"HTTP Request4\"},{\"parameters\":{\"numberInputs\":5},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[-7224,598],\"id\":\"ef6baf01-5963-4f67-84ef-0f02d19f45bb\",\"name\":\"Merge\"},{\"parameters\":{\"jsCode\":\"let allResults = [];\\nconst seen = new Set();\\n\\nfor (const item of items) {\\n  const children = item.json.data?.children || [];\\n\\n  for (const child of children) {\\n    const subreddit = child.data.display_name;\\n\\n    if (!seen.has(subreddit)) {\\n      seen.add(subreddit);\\n      allResults.push({\\n        json: {\\n          subreddit\\n        }\\n      });\\n    }\\n  }\\n}\\n\\nreturn allResults;\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-7004,640],\"id\":\"88a2ec98-3a5d-4baf-a277-67f5137a22ea\",\"name\":\"Code2\"},{\"parameters\":{\"fieldsToSummarize\":{\"values\":[{\"field\":\"metadata.subreddit\"}]},\"fieldsToSplitBy\":\"metadata.subreddit\",\"options\":{}},\"type\":\"n8n-nodes-base.summarize\",\"typeVersion\":1.1,\"position\":[-4804,540],\"id\":\"4360808c-8b57-473d-8d12-5bba50f1f20a\",\"name\":\"Summarize\"},{\"parameters\":{\"conditions\":{\"options\":{\"caseSensitive\":true,\"leftValue\":\"\",\"typeValidation\":\"strict\",\"version\":2},\"conditions\":[{\"id\":\"cdf5e8cf-d11a-4523-bb6c-f6406b41360f\",\"leftValue\":\"={{ $json.subreddit }}\",\"rightValue\":\"feminineboys\",\"operator\":{\"type\":\"string\",\"operation\":\"notEquals\"}}],\"combinator\":\"and\"},\"options\":{}},\"type\":\"n8n-nodes-base.filter\",\"typeVersion\":2.2,\"position\":[-6784,640],\"id\":\"5b84e639-0426-4af4-a3fa-170eda58f87a\",\"name\":\"Filter2\"}]",
        "parentFolderId": null,
        "pinData": "{}",
        "settings": "{\"executionOrder\":\"v1\"}",
        "staticData": null,
        "triggerCount": 0,
        "updatedAt": "2025-07-08 10:05:59",
        "versionId": "08085623-8616-426b-9e9a-18f8d00f15aa"
    },
    {
        "active": 0,
        "connections": "{\"When clicking ‘Execute workflow’\":{\"main\":[[{\"node\":\"CARGAR EMBEDDINGS SUPABASE2\",\"type\":\"main\",\"index\":0}]]},\"Code\":{\"main\":[[{\"node\":\"Google NLP\",\"type\":\"main\",\"index\":0}]]},\"Loop Over Items2\":{\"main\":[[{\"node\":\"Edit Fields\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Edit Fields1\",\"type\":\"main\",\"index\":0}]]},\"Replace Me2\":{\"main\":[[{\"node\":\"Loop Over Items2\",\"type\":\"main\",\"index\":0}]]},\"Merge\":{\"main\":[[{\"node\":\"Replace Me2\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields1\":{\"main\":[[{\"node\":\"Code\",\"type\":\"main\",\"index\":0},{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"Google NLP\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields\":{\"main\":[[{\"node\":\"Code5\",\"type\":\"main\",\"index\":0}]]},\"Code3\":{\"main\":[[{\"node\":\"Google NLP1\",\"type\":\"main\",\"index\":0}]]},\"Loop Over Items\":{\"main\":[[{\"node\":\"Edit Fields3\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Edit Fields2\",\"type\":\"main\",\"index\":0}]]},\"Replace Me\":{\"main\":[[{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0}]]},\"Merge1\":{\"main\":[[{\"node\":\"Replace Me\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields2\":{\"main\":[[{\"node\":\"Code3\",\"type\":\"main\",\"index\":0},{\"node\":\"Merge1\",\"type\":\"main\",\"index\":1}]]},\"Google NLP1\":{\"main\":[[{\"node\":\"Merge1\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Merge1\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields3\":{\"main\":[[{\"node\":\"Code2\",\"type\":\"main\",\"index\":0}]]},\"CARGAR EMBEDDINGS SUPABASE2\":{\"main\":[[{\"node\":\"Loop Over Items1\",\"type\":\"main\",\"index\":0},{\"node\":\"Loop Over Items\",\"type\":\"main\",\"index\":0},{\"node\":\"Loop Over Items2\",\"type\":\"main\",\"index\":0}]]},\"Code4\":{\"main\":[[{\"node\":\"Message a model\",\"type\":\"main\",\"index\":0}]]},\"Loop Over Items1\":{\"main\":[[{\"node\":\"Edit Fields5\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Edit Fields4\",\"type\":\"main\",\"index\":0}]]},\"Replace Me1\":{\"main\":[[{\"node\":\"Loop Over Items1\",\"type\":\"main\",\"index\":0}]]},\"Merge2\":{\"main\":[[{\"node\":\"Replace Me1\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields4\":{\"main\":[[{\"node\":\"Code4\",\"type\":\"main\",\"index\":0},{\"node\":\"Merge2\",\"type\":\"main\",\"index\":1}]]},\"Message a model\":{\"main\":[[{\"node\":\"Merge2\",\"type\":\"main\",\"index\":0}],[{\"node\":\"Merge2\",\"type\":\"main\",\"index\":0}]]},\"Edit Fields5\":{\"main\":[[{\"node\":\"Code6\",\"type\":\"main\",\"index\":0}]]},\"Code5\":{\"main\":[[{\"node\":\"Code1\",\"type\":\"main\",\"index\":0}]]},\"Code1\":{\"main\":[[{\"node\":\"CAPA 3 SUPABASE\",\"type\":\"main\",\"index\":0}]]},\"Code2\":{\"main\":[[{\"node\":\"CAPA 3 SUPABASE1\",\"type\":\"main\",\"index\":0}]]},\"Code6\":{\"main\":[[{\"node\":\"CAPA 3 SUPABASE2\",\"type\":\"main\",\"index\":0}]]}}",
        "createdAt": "2025-07-02 18:15:09.222",
        "id": "PJqj9z7SRAM7DWhI",
        "isArchived": 0,
        "meta": "{\"templateCredsSetupCompleted\":true}",
        "name": "CAPA 3: input_fact",
        "nodes": "[{\"parameters\":{},\"type\":\"n8n-nodes-base.manualTrigger\",\"typeVersion\":1,\"position\":[-2080,580],\"id\":\"7f508a13-852e-4e9e-9d62-19d4ac4b95f0\",\"name\":\"When clicking ‘Execute workflow’\"},{\"parameters\":{\"jsCode\":\"return [\\n  {\\n    json: {\\n      content: $json.content.replace(/\\\\n/g, \\\" \\\")\\n    }\\n  }\\n];\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-1200,-120],\"id\":\"c93c6374-008d-42f8-a17d-8c89f8538043\",\"name\":\"Code\"},{\"parameters\":{\"options\":{}},\"type\":\"n8n-nodes-base.splitInBatches\",\"typeVersion\":3,\"position\":[-1640,-45],\"id\":\"374fe295-0a6f-43fe-8b80-33f0c2adb832\",\"name\":\"Loop Over Items2\"},{\"parameters\":{},\"type\":\"n8n-nodes-base.noOp\",\"name\":\"Replace Me2\",\"typeVersion\":1,\"position\":[-384,30],\"id\":\"e88ada81-50db-482a-97fa-2cb75574715d\"},{\"parameters\":{\"mode\":\"combine\",\"combineBy\":\"combineByPosition\",\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[-604,-45],\"id\":\"807f4cec-e0ff-4db9-80f7-18b50ed84a75\",\"name\":\"Merge\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"637663a4-85e8-46c2-b5ed-da6b883a8345\",\"name\":\"content\",\"value\":\"={{ $json.content }}\",\"type\":\"string\"},{\"id\":\"f2469082-d67c-4993-b9bf-2a41e1bdf2cc\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-1420,-45],\"id\":\"fb97267e-7c68-43ad-a607-f45b87db471f\",\"name\":\"Edit Fields1\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://language.googleapis.com/v2/documents:analyzeEntities\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"googleCloudNaturalLanguageOAuth2Api\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={\\n  \\\"document\\\": {\\n    \\\"type\\\": \\\"PLAIN_TEXT\\\",\\n    \\\"content\\\": \\\"{{ $json[\\\"content\\\"] }}\\\"\\n  },\\n  \\\"encodingType\\\": \\\"UTF8\\\"\\n}\\n\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-902,-120],\"id\":\"c5c81c25-cbbd-4acc-a16e-c6f1a8f2eb48\",\"name\":\"Google NLP\",\"credentials\":{\"googleCloudNaturalLanguageOAuth2Api\":{\"id\":\"sGqjLcQWaMPsmG6o\",\"name\":\"Google Cloud Natural Language account\"}},\"disabled\":true,\"onError\":\"continueErrorOutput\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"6a1f08bd-1d10-48a4-b4fd-3a2301d7b88f\",\"name\":\"entities\",\"value\":\"={{ $json.entities }}\",\"type\":\"array\"},{\"id\":\"205c3d9d-a972-4b2e-9726-e79b27daf5e0\",\"name\":\"language\",\"value\":\"={{ $json.language }}\",\"type\":\"string\"},{\"id\":\"c66d6811-a87d-4678-9728-4310d6ab3c8e\",\"name\":\"content\",\"value\":\"={{ $json.content }}\",\"type\":\"string\"},{\"id\":\"09187988-81f5-492b-a23a-2d35c561f38f\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-1420,-320],\"id\":\"6559fd98-4c3a-425a-abbc-b52c98b14f5b\",\"name\":\"Edit Fields\"},{\"parameters\":{\"content\":\"## ANÁLISIS ENTITIES CON GOOGLE NLP\"},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-1940,-40],\"typeVersion\":1,\"id\":\"32bb5316-a7ef-4ee3-8d08-78c6b7954d74\",\"name\":\"Sticky Note\"},{\"parameters\":{\"jsCode\":\"return [\\n  {\\n    json: {\\n      content: $json.content.replace(/\\\\n/g, \\\" \\\")\\n    }\\n  }\\n];\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-1200,505],\"id\":\"b8e4067a-c05d-4f16-ad16-96618b69c4c6\",\"name\":\"Code3\"},{\"parameters\":{\"options\":{}},\"type\":\"n8n-nodes-base.splitInBatches\",\"typeVersion\":3,\"position\":[-1640,580],\"id\":\"d3c2ad6f-0763-49e0-bb76-ea94b218cc05\",\"name\":\"Loop Over Items\"},{\"parameters\":{},\"type\":\"n8n-nodes-base.noOp\",\"name\":\"Replace Me\",\"typeVersion\":1,\"position\":[-384,655],\"id\":\"e778cbdd-b360-483a-8100-e4805f322017\"},{\"parameters\":{\"mode\":\"combine\",\"combineBy\":\"combineByPosition\",\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[-604,580],\"id\":\"b6ecd977-c5c3-4830-9a92-079422a795d0\",\"name\":\"Merge1\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"637663a4-85e8-46c2-b5ed-da6b883a8345\",\"name\":\"content\",\"value\":\"={{ $json.content }}\",\"type\":\"string\"},{\"id\":\"f2469082-d67c-4993-b9bf-2a41e1bdf2cc\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-1420,580],\"id\":\"19dad30e-a812-4dcb-90ee-c1e6f55eeea2\",\"name\":\"Edit Fields2\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://language.googleapis.com/v1/documents:analyzeSentiment\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"googleCloudNaturalLanguageOAuth2Api\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={\\n  \\\"document\\\": {\\n    \\\"type\\\": \\\"PLAIN_TEXT\\\",\\n    \\\"content\\\": \\\"{{ $json[\\\"content\\\"] }}\\\"\\n  },\\n  \\\"encodingType\\\": \\\"UTF8\\\"\\n}\\n\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-902,505],\"id\":\"a771c99a-2783-4c3f-8013-3c3a74b1ee9b\",\"name\":\"Google NLP1\",\"credentials\":{\"googleCloudNaturalLanguageOAuth2Api\":{\"id\":\"sGqjLcQWaMPsmG6o\",\"name\":\"Google Cloud Natural Language account\"}},\"onError\":\"continueErrorOutput\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"09187988-81f5-492b-a23a-2d35c561f38f\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"},{\"id\":\"4ec823ce-b748-4a50-ba44-79c9c205b71b\",\"name\":\"documentSentiment\",\"value\":\"={{ $json.documentSentiment }}\",\"type\":\"object\"},{\"id\":\"cd5b57e4-fb91-4e4b-bc3e-77f7d57617cb\",\"name\":\"language\",\"value\":\"={{ $json.language }}\",\"type\":\"string\"},{\"id\":\"f86b181c-fe13-453a-a197-1e5568646a49\",\"name\":\"sentences\",\"value\":\"={{ $json.sentences }}\",\"type\":\"array\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-1420,305],\"id\":\"68e6db4e-efe6-4010-a053-102be086501f\",\"name\":\"Edit Fields3\"},{\"parameters\":{\"content\":\"## ANÁLISIS EMOTION CON GOOGLE NLP\"},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-2340,480],\"typeVersion\":1,\"id\":\"21769cf3-dd06-483b-9af1-a0ba307530f4\",\"name\":\"Sticky Note1\"},{\"parameters\":{\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_chunk?select=chunk_id,content\",\"authentication\":\"predefinedCredentialType\",\"nodeCredentialType\":\"supabaseApi\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-1860,580],\"id\":\"03860312-a377-4330-b6ad-366350781a70\",\"name\":\"CARGAR EMBEDDINGS SUPABASE2\",\"credentials\":{\"supabaseApi\":{\"id\":\"LOVa9pAD67DCJ7mo\",\"name\":\"Supabase account\"}}},{\"parameters\":{\"jsCode\":\"return [\\n  {\\n    json: {\\n      content: $json.content.replace(/\\\\n/g, \\\" \\\")\\n    }\\n  }\\n];\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-1200,1130],\"id\":\"abd8589f-7438-46bb-a37b-03f96a36a768\",\"name\":\"Code4\"},{\"parameters\":{\"options\":{}},\"type\":\"n8n-nodes-base.splitInBatches\",\"typeVersion\":3,\"position\":[-1640,1205],\"id\":\"3f7e22d7-d990-4606-8b9a-a22f1e5d3eda\",\"name\":\"Loop Over Items1\"},{\"parameters\":{},\"type\":\"n8n-nodes-base.noOp\",\"name\":\"Replace Me1\",\"typeVersion\":1,\"position\":[-384,1280],\"id\":\"3f561019-0dd9-4edf-a719-99c58f92c292\"},{\"parameters\":{\"mode\":\"combine\",\"combineBy\":\"combineByPosition\",\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[-604,1205],\"id\":\"01c9c539-c42b-491c-915b-d4ae0b4f022f\",\"name\":\"Merge2\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"637663a4-85e8-46c2-b5ed-da6b883a8345\",\"name\":\"content\",\"value\":\"={{ $json.content }}\",\"type\":\"string\"},{\"id\":\"f2469082-d67c-4993-b9bf-2a41e1bdf2cc\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-1420,1205],\"id\":\"07b05ce3-7e5d-4f78-8516-4fb1a87725f4\",\"name\":\"Edit Fields4\"},{\"parameters\":{\"assignments\":{\"assignments\":[{\"id\":\"09187988-81f5-492b-a23a-2d35c561f38f\",\"name\":\"chunk_id\",\"value\":\"={{ $json.chunk_id }}\",\"type\":\"number\"},{\"id\":\"bf397038-b8a4-4bf1-bee5-170b6791e695\",\"name\":\"message.content.fact_type\",\"value\":\"={{ $json.message.content.fact_type }}\",\"type\":\"string\"},{\"id\":\"e7de4044-ef29-45a1-852b-519550e2211e\",\"name\":\"message.content.value\",\"value\":\"={{ $json.message.content.value }}\",\"type\":\"string\"},{\"id\":\"7525f736-75c5-4dfe-ab53-ac5b027f80e7\",\"name\":\"message.content.confidence\",\"value\":\"={{ $json.message.content.confidence }}\",\"type\":\"number\"},{\"id\":\"9758686d-4f08-43ff-89a1-528230b62df2\",\"name\":\"content\",\"value\":\"={{ $json.content }}\",\"type\":\"string\"}]},\"options\":{}},\"type\":\"n8n-nodes-base.set\",\"typeVersion\":3.4,\"position\":[-1420,930],\"id\":\"66dab77a-dc47-4e40-a892-2bf1287b399d\",\"name\":\"Edit Fields5\"},{\"parameters\":{\"content\":\"## ANÁLISIS PAIN_POINT, NEED Y CLAIM CON LLM\",\"height\":180},\"type\":\"n8n-nodes-base.stickyNote\",\"position\":[-2060,1120],\"typeVersion\":1,\"id\":\"7ee94732-f626-419d-8720-27de4ed33c1a\",\"name\":\"Sticky Note2\"},{\"parameters\":{\"modelId\":{\"__rl\":true,\"value\":\"gpt-4o\",\"mode\":\"list\",\"cachedResultName\":\"GPT-4O\"},\"messages\":{\"values\":[{\"content\":\"ROLE: You are a semantic analyst specialized in extracting key psychological insights from unstructured user-generated text (such as Reddit comments, product reviews, or survey answers).\\n\\nTASK: Read the input text and identify any of the following semantic elements if present:\\n- Painpoint: A specific frustration, problem, obstacle or negative experience.\\n- Need: A desire, request, goal, or unmet expectation.\\n- Claim: A statement or belief, either about a product, experience or broader truth.\\n\\nRULES:\\n- Only return insights that are clearly implied or stated. Skip vague or irrelevant ideas.\\n- Each insight must be concise (max 20 words), written as a standalone sentence fragment.\\n- Assign each insight a `fact_type` (\\\"painpoint\\\", \\\"need\\\" or \\\"claim\\\") and a confidence level from 0 to 1.\\n- Return the output strictly in the following JSON format:\\n\\n[\\n  {\\n    \\\"fact_type\\\": \\\"painpoint | need | claim\\\",\\n    \\\"value\\\": \\\"insight as a short sentence fragment\\\",\\n    \\\"confidence\\\": 0.X\\n  },\\n  ...\\n]\\n\\nIf no relevant insights are found, return an empty list: `[]`\",\"role\":\"system\"},{\"content\":\"=Analyze the following text and extract any painpoints, needs or claims:\\n\\n{{ $json.content }}\"}]},\"jsonOutput\":true,\"options\":{\"temperature\":0.3,\"topP\":1}},\"type\":\"@n8n/n8n-nodes-langchain.openAi\",\"typeVersion\":1.8,\"position\":[-980,1130],\"id\":\"8dde2feb-4feb-4e29-821d-f7955a5423a5\",\"name\":\"Message a model\",\"credentials\":{\"openAiApi\":{\"id\":\"4KcNhnfACuLnC6w1\",\"name\":\"OpenAi account\"}},\"onError\":\"continueErrorOutput\"},{\"parameters\":{\"jsCode\":\"const results = [];\\nconst allowedTypes = [\\n  'PERSON',\\n  'ORGANIZATION',\\n  'CONSUMER_GOOD',\\n  'WORK_OF_ART',\\n  'LOCATION',\\n  'EVENT'\\n];\\n\\nfor (const item of items) {\\n  const data = item.json;\\n  const entities = data.entities;\\n  const chunk_id = data.chunk_id;\\n\\n  if (!Array.isArray(entities)) {\\n    console.log('No entities:', data);\\n    continue;\\n  }\\n\\n  for (const entity of entities) {\\n    if (!entity || !allowedTypes.includes(entity.type)) continue;\\n\\n    const probability = entity.mentions?.[0]?.probability ?? null;\\n\\n    results.push({\\n      json: {\\n        name: entity.name,\\n        type: entity.type,\\n        probability,\\n        chunk_id: chunk_id ?? null\\n      }\\n    });\\n  }\\n}\\n\\nreturn results;\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-1200,-320],\"id\":\"b939244d-39cb-4055-a6df-0a426295c98c\",\"name\":\"Code5\",\"alwaysOutputData\":false},{\"parameters\":{\"jsCode\":\"return items.map(item => ({\\n  json: {\\n    chunk_id: item.json.chunk_id,\\n    fact_type: \\\"entity\\\",\\n    entity_type: item.json.type,\\n    value: { text: item.json.name },\\n    confidence: item.json.probability,\\n    source: \\\"reddit\\\",\\n    extracted_by: \\\"gcloud_ner\\\",\\n    status: \\\"pendiente\\\"\\n  }\\n}));\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-902,-320],\"id\":\"b504039f-3913-4315-801c-bd317f32e668\",\"name\":\"Code1\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_fact\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Authorization\",\"value\":\"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"},{\"name\":\"apikey\",\"value\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={{ JSON.stringify($items().map(item => item.json)) }}\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-604,-320],\"id\":\"3cdadf35-69ff-443e-aa05-db0496bdb9bf\",\"name\":\"CAPA 3 SUPABASE\",\"executeOnce\":true,\"onError\":\"continueErrorOutput\"},{\"parameters\":{\"jsCode\":\"return items\\n  .filter(item =>\\n    item.json.documentSentiment &&\\n    item.json.documentSentiment.score !== null &&\\n    item.json.documentSentiment.magnitude !== null &&\\n    item.json.chunk_id !== null\\n  )\\n  .map(item => ({\\n    json: {\\n      chunk_id: item.json.chunk_id,\\n      fact_type: \\\"emotion\\\",\\n      value: {\\n        score: item.json.documentSentiment.score,\\n        magnitude: item.json.documentSentiment.magnitude\\n      },\\n      source: \\\"reddit\\\",\\n      extracted_by: \\\"gcloud_sentiment\\\",\\n      status: \\\"pendiente\\\"\\n    }\\n  }));\\n\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-1200,305],\"id\":\"648e8fa4-fd51-4877-b951-e01fbcc2fd78\",\"name\":\"Code2\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_fact\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Authorization\",\"value\":\"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"},{\"name\":\"apikey\",\"value\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={{ JSON.stringify($items().map(item => item.json)) }}\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-902,305],\"id\":\"dcc77359-e62b-40fc-9094-3778ee606bc7\",\"name\":\"CAPA 3 SUPABASE1\",\"executeOnce\":true,\"onError\":\"continueErrorOutput\"},{\"parameters\":{\"jsCode\":\"const normalizeFactType = (type) => {\\n  const map = {\\n    painpoint: \\\"pain point\\\",\\n    emotion: \\\"emotion\\\",\\n    claim: \\\"claim\\\",\\n    need: \\\"need\\\",\\n    entity: \\\"entity\\\",\\n    narrative: \\\"narrative\\\",\\n    \\\"attention hook\\\": \\\"attention hook\\\"\\n  };\\n  return map[type?.toLowerCase()?.trim()] ?? type;\\n};\\n\\nconst allowedTypes = [\\n  \\\"entity\\\", \\\"emotion\\\", \\\"pain point\\\", \\\"need\\\", \\\"claim\\\", \\\"attention hook\\\", \\\"narrative\\\"\\n];\\n\\nreturn items\\n  .map(item => {\\n    const factTypeRaw = item.json.message?.content?.fact_type;\\n    const normalized = normalizeFactType(factTypeRaw);\\n\\n    return {\\n      ...item,\\n      json: {\\n        ...item.json,\\n        normalized_fact_type: normalized\\n      }\\n    };\\n  })\\n  .filter(item =>\\n    item.json.normalized_fact_type &&\\n    allowedTypes.includes(item.json.normalized_fact_type) &&\\n    item.json.message?.content?.value &&\\n    item.json.chunk_id\\n  )\\n  .map(item => ({\\n    json: {\\n      chunk_id: item.json.chunk_id,\\n      fact_type: item.json.normalized_fact_type,\\n      value: { text: item.json.message.content.value },\\n      confidence: item.json.message.content.confidence ?? null,\\n      source: \\\"reddit\\\",\\n      extracted_by: \\\"gpt-4o\\\",\\n      status: \\\"pendiente\\\"\\n    }\\n  }));\\n\\n\"},\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[-1200,930],\"id\":\"47b2b244-29dd-4d57-84bc-041db3f4f842\",\"name\":\"Code6\"},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://zuellanyoiavacebkozv.supabase.co/rest/v1/input_fact\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"Content-Type\",\"value\":\"application/json\"},{\"name\":\"Authorization\",\"value\":\"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"},{\"name\":\"apikey\",\"value\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1ZWxsYW55b2lhdmFjZWJrb3p2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NTU0MzIsImV4cCI6MjA2NTIzMTQzMn0.cNh1BFZ2lzPzIwuPptrGMoQnxcwPheK6CQW3v1oYiG0\"}]},\"sendBody\":true,\"contentType\":\"raw\",\"rawContentType\":\"application/json\",\"body\":\"={{ JSON.stringify($items().map(item => item.json)) }}\",\"options\":{}},\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[-902,930],\"id\":\"9753a9fb-1ee4-46a5-8502-10f5c9f98455\",\"name\":\"CAPA 3 SUPABASE2\",\"executeOnce\":true,\"onError\":\"continueErrorOutput\"}]",
        "parentFolderId": null,
        "pinData": "{}",
        "settings": "{\"executionOrder\":\"v1\"}",
        "staticData": null,
        "triggerCount": 0,
        "updatedAt": "2025-07-23 12:24:45",
        "versionId": "8bef154d-981e-485c-adb2-b3b0955cdb80"
    }
]